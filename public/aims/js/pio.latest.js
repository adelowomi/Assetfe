/*! printio_widget - v1.1.13 - 2014-04-02
* Copyright (c) 2014 breakout commerce; Licensed  */
!function(a){var b=function(){var b={v:"1",hasOpenChannel:!1,opts:{},lastOpts:{},hadConfig:!1,fns:{},hasLocalStorage:!1,hadPushstateWire:!1},c=this,d=function(a){return"pio."+b.v+"."+a},e={debug:!1,embedInElement:!1,images:[],items:[],canUseUpload:!0,canBuyOtherProducts:!0,canUseMap:!0,goTo:"",goToCustomize:!1,orderId:null,usePushState:!1,fadeBackground:!0,countryCode:"",currencyCode:"",languageCode:"",fns:{onCartChange:function(){},onClose:function(){},onOpen:function(){}},style:{showHeader:!0},recipeId:"",url:"http://staging.widget.print.io/widget/"},f=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},g=function(a,c){var d=b;d.fns.hasOwnProperty(a)&&d.fns[a].apply(d.fns[a],c)},h=function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null==c?"":decodeURIComponent(c[1].replace(/\+/g," "))},i=function(){return a&&a.console?function(){console.log.apply(console,arguments)}:function(){}},j=function(a,b){var c={};if(!b)return a;for(var d in a)c[d]=b.hasOwnProperty(d)?f(a[d])?b[d].slice(0):b[d]:f(a[d])?a[d].slice(0):a[d];return c},k=function(){var c=b.lastOpts,d=document.createElement("iframe"),e=d.style;return d.src=c.url+c.recipeId,(c.countryCode||c.languageCode||c.debug)&&(d.src+="?",c.languageCode&&(d.src+="language="+c.languageCode+"&"),c.countryCode&&(d.src+="country="+c.countryCode+"&"),c.debug&&(d.src+="debug=true&"),d.src=d.src.substr(0,d.src.length-1)),d.id="__pio",e.width=a.chrome&&a.devicePixelRatio&&a.devicePixelRatio>1&&-1!=navigator.appVersion.indexOf("Mac")?"972px":"952px",e.height="652px",c.style.showHeader||(e.height="607px"),d.frameBorder=0,d.setAttribute("seamless","seamless"),d.setAttribute("scolling","no"),d.marginHeight=0,d.marginWidth=0,d.hspace=0,d.vspace=0,e.margin="auto",e.boxSizing="border-box",e.borderRadius="5px",e.top=(void 0!==a.pageYOffset?a.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop)+20+"px",e.overflow="none",e.zIndex=999999,c.embedInElement?d:(e.position="absolute",e.left=0,e.right=0,d)},l=function(){return document.getElementById("__pio")},m=function(){var a=l(),b=document.getElementById("__pio_f");a&&(a.parentNode.removeChild(a),g("onClose")),b&&b.parentNode.removeChild(b)},n=function(){return!!b.lastOpts.embedInElement},o=function(a){i()("PIO: injecting"),n()?b.lastOpts.embedInElement.appendChild(a):document.getElementsByTagName("body")[0].appendChild(a)},p=function(){var a=b.lastOpts,c=document.createElement("div"),d=c.style;a.fadeBackground&&!n()&&(document.getElementById("__pio_f")||(d.position="absolute",d.top="0px",d.left="0px",d.width="100%",d.height=Math.max(document.documentElement.scrollHeight,document.height||document.documentElement.clientWidth)+"px",d.background="rgba(0,0,0,.7)",d.zIndex=999998,c.id="__pio_f",document.getElementsByTagName("body")[0].appendChild(c),c.addEventListener("click",function(){m()})))},q=function(c){var d=c.data||c.originalEvent.data;if(d&&d.data&&d.data.cmd){if(i()("PIO: parent received",d.data.cmd,c),d.hasOwnProperty("PIOF")){var e=d.data;if("close"===e.cmd)m();else if("hi"===e.cmd)s("set-options",b.lastOpts),b.opts.orderid=null;else if("onCartChange"===e.cmd)v(e.data);else if("paypal"===e.cmd){var f=document.createElement("div");f.innerHTML=e.data.replace("!RRR!",a.location.toString()),document.body.appendChild(f);var g=document.getElementsByClassName("js-paypal-form")[0];g.submit()}else"analytics-addTransaction"===e.cmd?a.ga&&ga("ecommerce:addTransaction",e.data):"analytics-addItem"===e.cmd?a.ga&&ga("ecommerce:addItem",e.data):"analytics-send"===e.cmd?a.ga&&ga("ecommerce:send"):"analytics-event"===e.cmd?a.ga&&ga("send",e.data):"analytics-pageview"===e.cmd&&a.ga&&ga("send","pageview",e.data)}}else i()("PIO: anon msg",d)},r=function(){b.hasLocalStorage=u()},s=function(a,b){var c=document.getElementById("__pio");i()("PIO: sending message",a,b),c.contentWindow.postMessage({PIOP:!0,cmd:a,data:b},"*")},t=function(){b.hasOpenChannel||(i()("PIO: attaching"),a.addEventListener("message",q,!1),b.hasOpenChannel=!0)},u=function(){try{return"localStorage"in a&&null!==a.localStorage}catch(b){return!1}},v=function(a){a?(i()("PIOP: cart has items",a.items.length),b.hasLocalStorage&&(localStorage[d("cart")]=JSON.stringify(a))):b.hasLocalStorage&&(localStorage[d("cart")]=null),b.fns&&b.fns.onCartChange&&b.fns.onCartChange(a)},w=function(){try{var a=localStorage[d("cart")];if(a)return JSON.parse(a)}catch(b){return!1}},x=function(){b.opts.usePushState&&history.pushState({to:"start"},null),b.hadPushstateWire||a.addEventListener("popstate",function(a){i()("PIOP: popstate"),console.dir(a),a.state?"start"===a.state.to&&m():m()})},y=function(){var a=w(),b=new Date,c=new Date(b-864e5),d=[];return a&&Date.parse(a.timeStamp)>c&&a.items.forEach(function(a){d.push(a)}),d},z=function(){b.opts=j(b.opts,{images:[],items:[],goTo:"",goToCustomize:!1,orderId:null})};this.config=function(c,d){r();var f=a.location.toString();-1!==f.indexOf("paypalreturn")&&-1!==f.indexOf("orderid"),b.opts.orderid=h("orderid");var g=j(e,c||{});b.opts=g,b.fns=g.fns,b.opts.fns&&delete b.opts.fns,d&&d(b),i()("config fns",b.fns),z(),b.hadConfig=!0},this.open=function(a,c){b.lastOpts={};var d=a;b.lastOpts=b.hadConfig?j(j(e,b.opts),{}):j(e,{}),b.lastOpts=j(b.lastOpts,d||{}),i()("PIOP: options",b),d&&d.fns&&(b.fns=b.hadConfig?j(b.fns,d.fns):j(e.fns,d.fns),delete b.lastOpts.fns),r(),y().forEach(function(a){b.lastOpts.items.push(a)}),m(),t(),x(),p(),o(k()),b.lastOpts.fns&&delete b.lastOpts.fns,b.lastOpts.embedInElement&&(b.lastOpts.embedInElement=null),c&&c(b),b.fns.onOpen&&b.fns.onOpen()},this.close=function(){m()},this.showCart=function(a){l()?s("goto","tpl-cart"):(a=a||{},a.goTo="tpl-cart",c.open(a))},this.clearCart=function(){v(null)},this.getCart=w,this.getNumItems=function(){r();var a=y();return a.length?a.reduce(function(a,b){return a+=b.quantity},0):0}};a.PIO=new b,a.PIO.ctor=b}(window);